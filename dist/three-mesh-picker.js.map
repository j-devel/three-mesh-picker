{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 3d861099496a621d5e15","webpack:///./src/index.js","webpack:///./src/MeshPicker.js","webpack:///external \"THREE\""],"names":["MeshPicker","THREE","width","height","opts","undefined","can","document","createElement","_canvas","_renderer","WebGLRenderer","canvas","rtWidth","renderTagetWidth","rtHeight","renderTagetHeight","_rt","WebGLRenderTarget","magFilter","NearestFilter","minFilter","wrapS","ClampToEdgeWrapping","wrapT","_side","side","FrontSide","_materialPick","RawShaderMaterial","vertexShader","fragmentShader","transparent","_scene","Scene","_meshPairs","_len","_mapUuidIdx","_materialDepth","MeshDepthMaterial","depthPacking","RGBADepthPacking","unpackDownscale","_unpackFactors","Vector4","mesh","idx","console","log","Mesh","has","meshPick","clone","material","geom","geometry","hex","i","faces","length","color","setHex","vertexColors","FaceColors","colorsNeedUpdate","uuid","a","pop","_truncateMeshPairs","screening","createPickableFrom","push","add","remove","dispose","meshes","forEach","pair","Object","keys","list","m","clear","w","h","mx","my","camera","_inspect","forDepth","position","x","y","z","rotation","bgOrig","background","white","Color","overrideMaterial","render","pixel","Uint8Array","readRenderTargetPixels","viewZ","computeDepth","far","near","point","getPositionFromViewZ","cf","cn","invClipZ","fromArray","multiplyScalar","dot","pos","Vector3","projInv","Matrix4","getInverse","projectionMatrix","applyMatrix4","matrixWorld","recursive","raycaster","Raycaster","mouse","Vector2","setFromCamera","intersects","intersectObjects","count"],"mappings":"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","file":"three-mesh-picker.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"THREE\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"THREE\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"MeshPicker\"] = factory(require(\"THREE\"));\n\telse\n\t\troot[\"MeshPicker\"] = factory(root[\"THREE\"]);\n})(typeof self !== 'undefined' ? self : this, function(__WEBPACK_EXTERNAL_MODULE_2__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 3d861099496a621d5e15","'use strict';\n\nimport MeshPicker from './MeshPicker.js';\n\n// https://hackernoon.com/import-export-default-require-commandjs-javascript-nodejs-es6-vs-cheatsheet-different-tutorial-example-5a321738b50f\n//--------\nexport default MeshPicker;\n// [browser]: <script src=\"three-mesh-picker.js\"></script>\n//            window.MeshPicker is now available\n// [node]: const MeshPicker = require('three-mesh-picker');\n//--------\n// export { MeshPicker };\n// [browser]: <script src=\"three-mesh-picker.js\"></script>\n//            const MeshPicker = window['MeshPicker'].MeshPicker;\n// [node]: const MeshPicker = require('MeshPicker').MeshPicker;\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","'use strict';\n\n// https://threejs.org/docs/#manual/introduction/Import-via-modules\nimport * as THREE from 'three';\n\nexport default class MeshPicker {\n    constructor(width, height, opts={}) {\n        if (width === undefined || height === undefined) {\n            throw 'error: both viewport width and height must be provided.';\n        }\n        let can = document.createElement('canvas');\n        can.width = width; // viewport width\n        can.height = height; // viewport height\n        this._canvas = can;\n        this._renderer = new THREE.WebGLRenderer({\n            canvas: can,\n        });\n        let rtWidth = opts.renderTagetWidth ? opts.renderTagetWidth : 512;\n        let rtHeight = opts.renderTagetHeight ? opts.renderTagetHeight : 512;\n        this._rt = new THREE.WebGLRenderTarget(rtWidth, rtHeight, {\n            magFilter: THREE.NearestFilter,\n            minFilter: THREE.NearestFilter,\n            wrapS: THREE.ClampToEdgeWrapping,\n            wrapT: THREE.ClampToEdgeWrapping,\n        });\n        // console.log('rt:', this._rt);\n\n        this._side = opts.side !== undefined ? opts.side : THREE.FrontSide;\n        this._materialPick = new THREE.RawShaderMaterial({\n            vertexShader: `\n                precision mediump float;\n                precision mediump int;\n                uniform mat4 modelViewMatrix;\n                uniform mat4 projectionMatrix;\n                attribute vec3 position;\n                attribute vec4 color;\n                varying vec4 vColor;\n                void main() {\n                    vColor = color;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n                }\n            `,\n            fragmentShader: `\n                precision mediump float;\n                precision mediump int;\n                varying vec4 vColor;\n                void main() {\n                    gl_FragColor = vColor;\n                }\n            `,\n            side: this._side,\n            // side: THREE.FrontSide,\n            // side: THREE.BackSide,\n            // side: THREE.DoubleSide,\n            transparent: false,  // disable blending, NG otherwise.\n        });\n\n        this._scene = new THREE.Scene();\n        this._meshPairs = []; // [[mesh0, meshPick0], [mesh1, meshPick1], ...]\n        this._len = 0; // current max idx used for this._meshPairs\n        this._mapUuidIdx = {}; // mesh.uuid -> _idx\n\n        // depth stuff\n        // https://stackoverflow.com/questions/44121266/compute-3d-point-from-mouse-position-and-depth-map\n        this._materialDepth = new THREE.MeshDepthMaterial({\n            depthPacking: THREE.RGBADepthPacking,\n            side: this._side,\n        });\n        const unpackDownscale = 255 / 256;\n        this._unpackFactors = new THREE.Vector4(\n            unpackDownscale / (256 * 256 * 256),\n            unpackDownscale / (256 * 256),\n            unpackDownscale / 256,\n            unpackDownscale);\n    }\n    screening(mesh, idx) {\n        if (idx > 0xffffff) { // 256**3-1 = 16777215\n            console.log(`nop: exceeded the max number of meshes supported.\n                Or, call clear() and add() meshes again.`);\n            return false;\n        }\n        if (! (mesh instanceof THREE.Mesh)) {\n            console.log('nop: the base object is not of type THREE.Mesh');\n            return false;\n        } else if (this.has(mesh)) {\n            console.log('nop: already added.');\n            return false;\n        }\n        return true;\n    }\n\n    createPickableFrom(mesh, idx) {\n        // https://stackoverflow.com/questions/33806640/how-to-change-material-color-for-only-one-object-in-three-js\n        let meshPick = mesh.clone();\n        // override the shader program\n        meshPick.material = this._materialPick;\n\n        // encode id into [attribute vec4 color]\n        let geom = meshPick.geometry.clone(); // depp copy for edit\n        //---- OK\n        // https://stackoverflow.com/questions/17859823/three-js-webgl-renderer-not-updating-color-property-on-faces\n        // let hex = Math.random() * 0xffffff; // debug\n        let hex = idx;\n        for (let i = 0; i < geom.faces.length; i ++) {\n            geom.faces[i].color.setHex(hex);\n        }\n        meshPick.material.vertexColors = THREE.FaceColors;\n        meshPick.material.colorsNeedUpdate = true;\n        //---- not relevant, just a memo\n        // // this is for Points/Line; not for picking faces - https://threejs.org/docs/#api/core/Geometry.colors\n        // // https://github.com/mrdoob/three.js/issues/7361\n        // // e.g.\n        // geom.colors = [ new THREE.Color(), new THREE.Color(), new THREE.Color(), new THREE.Color() ];\n        // geom.colors[ 0 ].setRGB( 1, 0, 0 );\n        // geom.colors[ 1 ].setRGB( 1, 0, 0 );\n        // geom.colors[ 2 ].setRGB( 1, 0, 0 );\n        // geom.colors[ 3 ].setRGB( 1, 0, 0 );\n        // geom.colorsNeedUpdate = true;\n        // meshPick.material.vertexColors = THREE.VertexColors;\n        // meshPick.material.needsUpdate = true;\n\n        meshPick.geometry = geom;\n        return meshPick;\n    }\n    has(mesh) {\n        return mesh.uuid in this._mapUuidIdx;\n    }\n    _truncateMeshPairs() {\n        // truncate null entries (made due to remove()) in this._meshPairs if any\n        let a = this._meshPairs;\n        for (let i = a.length-1; i >= 0 && a[i] === null; i--) {\n            a.pop();\n            this._len--;\n        }\n    }\n    add(mesh) {\n        this._truncateMeshPairs();\n        let idx = this._len;\n        if (! this.screening(mesh, idx)) return;\n\n        let meshPick = this.createPickableFrom(mesh, idx);\n\n        // meshPick.position.x *= -1.0; // just for debug\n        // console.log('meshPick:', meshPick);\n        this._meshPairs.push([mesh, meshPick]);\n        this._mapUuidIdx[mesh.uuid] = idx;\n        this._scene.add(meshPick);\n        this._len++;\n    }\n    remove(mesh) {\n        if (! this.has(mesh)) {\n            console.log('nop, not found');\n            return;\n        }\n\n        // delete index map\n        let idx = this._mapUuidIdx[mesh.uuid];\n        delete this._mapUuidIdx[mesh.uuid];\n\n        // let a corresponding pair be a \"hole\"\n        let meshPick = this._meshPairs[idx][1];\n        this._meshPairs[idx] = null;\n        // make sure null's are truncated\n        this._truncateMeshPairs();\n\n        // delete a corresponding meshPick - https://stackoverflow.com/questions/40694372/what-is-the-right-way-to-remove-a-mesh-completely-from-the-scene-in-three-js?rq=1\n        this._scene.remove(meshPick);\n        meshPick.geometry.dispose();\n        // meshPick.material (this._materialPick) is shared, so don't dispose() it\n        meshPick = null;\n    }\n    list() {\n        let meshes = [];\n        this._meshPairs.forEach((pair) => {\n            if (pair !== null) { meshes.push(pair[0]); }\n        });\n        return meshes;\n    }\n    count() {\n        return Object.keys(this._mapUuidIdx).length;\n    }\n    clear() {\n        // remove all meshes\n        let meshes = this.list();\n        meshes.forEach((m) => { this.remove(m); });\n        meshes.length = 0;\n\n        // reset the dynamic array with holes\n        this._meshPairs.length = 0;\n        this._len = 0;\n    }\n    dispose() {\n        // clear all meshes\n        this.clear();\n\n        // clear other stuff\n        this._materialPick = undefined;\n        this._scene = undefined;\n        this._canvas = undefined;\n        this._renderer = undefined;\n        this._rt = undefined;\n    }\n    updateWidth(w) {\n        this._canvas.width = w;\n    }\n    updateHeight(h) {\n        this._canvas.height = h;\n    }\n    pickMesh(mx, my, camera) {\n        return this._inspect(mx, my, camera, false);\n    }\n    pickPoint(mx, my, camera) {\n        return this._inspect(mx, my, camera, true);\n    }\n    _inspect(mx, my, camera, forDepth) {\n        if (camera === undefined) {\n            console.log('nop, camera not set...');\n            return null;\n        }\n\n        // make sure the poses of meshPick's are updated\n        this._meshPairs.forEach((pair) => {\n            if (pair === null) return; // https://stackoverflow.com/questions/31399411/go-to-next-iteration-in-javascript-foreach-loop/31399448\n            pair[1].position.x = pair[0].position.x;\n            pair[1].position.y = pair[0].position.y;\n            pair[1].position.z = pair[0].position.z;\n            pair[1].rotation.x = pair[0].rotation.x;\n            pair[1].rotation.y = pair[0].rotation.y;\n            pair[1].rotation.z = pair[0].rotation.z;\n        });\n\n        let bgOrig = this._scene.background;\n        let white = 0xffffff;\n        this._scene.background = new THREE.Color(white);\n        if (forDepth) {\n            this._scene.overrideMaterial = this._materialDepth;\n            this._renderer.render(this._scene, camera, this._rt);\n            this._scene.overrideMaterial = null;\n        } else {\n            this._renderer.render(this._scene, camera, this._rt);\n        }\n        this._scene.background = bgOrig;\n\n        // https://github.com/mrdoob/three.js/blob/master/examples/webgl_interactive_cubes_gpu.html\n        let pixel = new Uint8Array(4);\n        const w = this._canvas.width;\n        const h = this._canvas.height;\n        this._renderer.readRenderTargetPixels(\n            this._rt,\n            mx / w * this._rt.width,\n            (1 - my / h) * this._rt.height,\n            1, 1, pixel);\n        // console.log(\"pixel:\", pixel);\n        // console.log(`picked data: ${pixel[0]} ${pixel[1]} ${pixel[2]} ${pixel[3]} -> ${idx} `);\n        let idx = (pixel[0]<<16) | (pixel[1]<<8) | pixel[2];\n        if (idx === white) {\n            // console.log(\"picked none\");\n            return null;\n        }\n\n        if (forDepth) {\n            let viewZ = this.computeDepth(pixel, camera.far, camera.near);\n            // console.log('viewZ:', viewZ);\n            let point = this.getPositionFromViewZ(viewZ, mx, my, camera, w, h);\n            console.log('point:', point);\n            return point;\n        } else {\n            return this._meshPairs[idx][0];\n        }\n    }\n    //-------- depth stuff\n    // https://stackoverflow.com/questions/44121266/compute-3d-point-from-mouse-position-and-depth-map\n    computeDepth(pixel, cf, cn) {\n        // unpackRGBAToDepth()\n        let invClipZ = (new THREE.Vector4()).fromArray(pixel)\n            .multiplyScalar(1 / 255)\n            .dot(this._unpackFactors);\n        // perspectiveDepthToViewZ()\n        return (cn * cf) / ((cf - cn) * invClipZ - cf);\n    }\n    getPositionFromViewZ(viewZ, mx, my, camera, w, h) {\n        let pos = new THREE.Vector3(mx/w*2-1, -(my/h)*2+1, 0.5);\n        const projInv = new THREE.Matrix4();\n        projInv.getInverse(camera.projectionMatrix);\n        pos.applyMatrix4(projInv);\n        pos.multiplyScalar(viewZ / pos.z);\n        pos.applyMatrix4(camera.matrixWorld);\n        return pos;\n    }\n    getPositionInfinity(mx, my, camera) {\n        return this.getPositionFromViewZ(\n            -camera.far, mx, my, camera,\n            this._canvas.width, this._canvas.height);\n    }\n    //--------\n    raycast(mx, my, meshes, camera, recursive=false) {\n        // https://threejs.org/docs/#api/core/Raycaster\n        let raycaster = new THREE.Raycaster();\n        let mouse = new THREE.Vector2(); // normalized (-1 to +1)\n        mouse.x = (mx / this._canvas.width) * 2 - 1;\n        mouse.y = - (my / this._canvas.height) * 2 + 1;\n        // update the picking ray with the camera and mouse position\n        raycaster.setFromCamera(mouse, camera);\n        // calculate mesh intersecting the picking ray\n        let intersects = raycaster.intersectObjects(meshes, recursive);\n        // console.log('intersects:', intersects);\n        // intersects are sorted by distance\n        return intersects.length > 0 ? intersects[0] : null;\n    }\n    log() {\n        console.log('log(): ======== ========');\n        console.log('this._len:', this._len);\n        console.log('this.count():', this.count());\n        console.log('this._scene:', this._scene);\n        console.log('this._meshPairs (null holes allowed; but must be truncated):', this._meshPairs);\n        console.log('this._mapUuidIdx:', this._mapUuidIdx);\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/MeshPicker.js","module.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"THREE\"\n// module id = 2\n// module chunks = 0"],"sourceRoot":""}